<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rumah Tahfidz Saijaan - Beranda</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background-color: #f8f8f8;
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }
        a {
            transition: color 0.3s;
        }
        a:hover {
            color: #e2e8f0;
        }
        .card {
            background-color: #672cfb;
            padding: 1.5rem;
            border-radius: 0.375rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s;
            text-align: center;
        }
        .card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        header, footer {
            background-color: #6b0f0f;
            color: #ffffff;
            padding: 1rem;
            text-align: center;
        }
        .logo {
            width: 50px;
            height: auto;
        }
        @media screen and (min-width: 600px) {
            body {
                max-width: 800px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
    <header>
        <div class="container mx-auto px-4 py-6 flex items-center">
            <img src="img/logo.jpg" alt="Logo Rumah Tahfidz Saijaan" class="logo w-12 h-auto mr-1 max-w-xs" />
            <h1 class="text-2xl md:text-3xl font-bold flex-grow text-center md:text-left">Rumah Tahfidz Saijaan</h1>
            <div class="md:hidden">
                <button id="menu-toggle" class="text-white focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
            <nav class="hidden md:flex space-x-4">
                <a href="baru.html" class="font-semibold hover:underline">Kelas Aktif</a>
                <a href="infaq.html" class="font-semibold hover:underline">Cari No. Infaq</a>
                <a href="abseninfaq.html" class="font-semibold hover:underline">Generator Absen</a>
                <a href="digital.html" class="font-semibold hover:underline">Absen Digital</a>
            </nav>
        </div>
        <div id="mobile-menu" class="md:hidden hidden">
            <nav class="flex flex-col items-center space-y-2 mt-4">
                <a href="baru.html" class="font-semibold hover:underline">Kelas Aktif</a>
                <a href="infaq.html" class="font-semibold hover:underline">Cari No. Infaq</a>
                <a href="abseninfaq.html" class="font-semibold hover:underline">Generator Absen</a>
                <a href="digital.html" class="font-semibold hover:underline">Absen Digital</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <h2 class="text-2xl font-semibold mb-6 text-center">Sistem Administrasi Santri</h2>
        
        <!-- Tambahkan div untuk menampilkan statistik -->
        <div id="statistik" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="card bg-blue-500 text-white cursor-pointer" id="santriCard">
                <h3 class="text-xl font-semibold mb-2">Jumlah Santri</h3>
                <p id="jumlahSantri" class="text-3xl font-bold">-</p>
            </div>
            <div class="card bg-green-500 text-white cursor-pointer" id="guruCard">
                <h3 class="text-xl font-semibold mb-2">Jumlah Guru</h3>
                <p id="jumlahGuru" class="text-3xl font-bold">-</p>
            </div>
            <div class="card bg-yellow-500 text-white cursor-pointer" id="kelasCard">
                <h3 class="text-xl font-semibold mb-2">Jumlah Kelas</h3>
                <p id="jumlahKelas" class="text-3xl font-bold">-</p>
            </div>
        </div>
        
        <!-- Tambahkan div untuk menampilkan sebaran santri -->
        <div id="sebaranSantri" class="hidden mt-8 bg-white p-4 rounded-lg shadow">
            <h3 class="text-xl font-semibold mb-4">Sebaran Santri per Guru</h3>
            <div id="sebaranList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Daftar sebaran akan ditambahkan di sini -->
            </div>
        </div>
        
        <!-- Tambahkan div untuk menampilkan daftar guru dan kelas -->
        <div id="daftarGuru" class="hidden mt-8 bg-white p-4 rounded-lg shadow">
            <h3 class="text-xl font-semibold mb-4">Daftar Guru dan Kelas</h3>
            <div id="guruList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Daftar guru dan kelas akan ditambahkan di sini -->
            </div>
        </div>
        
        <!-- Tambahkan div untuk menampilkan daftar kelas -->
        <div id="daftarKelas" class="hidden mt-8 bg-white p-4 rounded-lg shadow">
            <h3 class="text-xl font-semibold mb-4">Daftar Kelas dan Jumlah Santri</h3>
            <div id="kelasList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Daftar kelas akan ditambahkan di sini -->
            </div>
        </div>
        
        <p class="mb-4 text-center">Silakan pilih halaman yang ingin Anda kunjungi:</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <a href="digital.html" class="card">
                <h3 class="text-xl font-semibold mb-2">ABSENSI DIGITAL</h3>
                <p>efisien, akurat, cepat, praktis, hemat waktu, mudah diakses</p>
            </a>
            <a href="baru.html" class="card">
                <h3 class="text-xl font-semibold mb-2">KELAS AKTIF</h3>
                <p>Lihat kelas aktif santri periode September s/d Desember 2024</p>
            </a>
        </div>
    </main>

    <footer>
        <div class="container mx-auto px-4 py-6">
            <p class="text-center">&copy; 2024 Rumah Tahfidz Saijaan. Hak Cipta Dilindungi.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi Supabase client
            const supabaseUrl = 'https://lrkechznknwqnxckyfcg.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxya2VjaHpua253cW54Y2t5ZmNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjkxMjgzODEsImV4cCI6MjA0NDcwNDM4MX0.Tj8p1u3_DGQnqhPkS6AJGs5BwOSeebdvsknX2qHzwdQ';
            const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey, {
                auth: {
                    autoRefreshToken: false,
                    persistSession: false
                },
                global: {
                    headers: {
                        Authorization: `Bearer ${supabaseKey}`,
                        apikey: supabaseKey
                    },
                },
            });

            let santriData;

            async function tampilkanStatistik() {
                try {
                    const { data, error } = await supabaseClient
                        .from('santri')
                        .select('NAMA, GURU, KELAS');

                    if (error) throw error;

                    santriData = data;
                    const jumlahSantri = santriData.length;
                    const guruUnik = new Set(santriData.map(s => s.GURU));
                    const jumlahGuru = guruUnik.size;
                    const kelasUnik = new Set(santriData.map(s => `${s.GURU}-${s.KELAS}`));
                    const jumlahKelas = kelasUnik.size;

                    document.getElementById('jumlahSantri').textContent = jumlahSantri;
                    document.getElementById('jumlahGuru').textContent = jumlahGuru;
                    document.getElementById('jumlahKelas').textContent = jumlahKelas;

                } catch (error) {
                    console.error('Error mengambil data:', error);
                    alert('Terjadi kesalahan saat mengambil data statistik.');
                }
            }

            function tampilkanSebaranSantri() {
                const sebaranSantri = {};
                santriData.forEach(santri => {
                    sebaranSantri[santri.GURU] = (sebaranSantri[santri.GURU] || 0) + 1;
                });

                const totalSantri = santriData.length;
                const sebaranList = document.getElementById('sebaranList');
                sebaranList.innerHTML = '';

                for (const [guru, jumlah] of Object.entries(sebaranSantri)) {
                    const persentase = ((jumlah / totalSantri) * 100).toFixed(1);
                    const sebaranItem = document.createElement('div');
                    sebaranItem.className = 'bg-gray-100 p-3 rounded';
                    sebaranItem.innerHTML = `
                        <p class="font-semibold">${guru}</p>
                        <p>${jumlah} santri (${persentase}%)</p>
                    `;
                    sebaranList.appendChild(sebaranItem);
                }

                document.getElementById('sebaranSantri').classList.remove('hidden');
            }

            function tampilkanDaftarGuru() {
                const guruKelas = {};
                santriData.forEach(santri => {
                    if (!guruKelas[santri.GURU]) {
                        guruKelas[santri.GURU] = {};
                    }
                    if (!guruKelas[santri.GURU][santri.KELAS]) {
                        guruKelas[santri.GURU][santri.KELAS] = 0;
                    }
                    guruKelas[santri.GURU][santri.KELAS]++;
                });

                const guruList = document.getElementById('guruList');
                guruList.innerHTML = '';

                for (const [guru, kelas] of Object.entries(guruKelas)) {
                    const guruItem = document.createElement('div');
                    guruItem.className = 'bg-gray-100 p-3 rounded';
                    
                    const kelasInfo = Object.entries(kelas).map(([namaKelas, jumlahSantri]) => 
                        `${namaKelas} (${jumlahSantri} santri)`
                    ).join(' & ');
                    
                    guruItem.innerHTML = `
                        <p class="font-semibold">${guru}</p>
                        <p>Kelas: ${kelasInfo}</p>
                    `;
                    guruList.appendChild(guruItem);
                }

                document.getElementById('daftarGuru').classList.remove('hidden');
            }

            function tampilkanDaftarKelas() {
                const kelasData = {};
                santriData.forEach(santri => {
                    const kelasKey = `${santri.GURU}-${santri.KELAS}`;
                    if (!kelasData[kelasKey]) {
                        kelasData[kelasKey] = { guru: santri.GURU, kelas: santri.KELAS, jumlahSantri: 0 };
                    }
                    kelasData[kelasKey].jumlahSantri++;
                });

                const kelasList = document.getElementById('kelasList');
                kelasList.innerHTML = '';

                Object.values(kelasData).sort((a, b) => a.guru.localeCompare(b.guru) || a.kelas.localeCompare(b.kelas)).forEach(kelas => {
                    const kelasItem = document.createElement('div');
                    kelasItem.className = 'bg-gray-100 p-3 rounded';
                    kelasItem.innerHTML = `
                        <p class="font-semibold">${kelas.guru} - ${kelas.kelas}</p>
                        <p>Jumlah Santri: ${kelas.jumlahSantri}</p>
                    `;
                    kelasList.appendChild(kelasItem);
                });

                document.getElementById('daftarKelas').classList.remove('hidden');
            }

            function tutupSebaranSantri() {
                document.getElementById('sebaranSantri').classList.add('hidden');
            }

            function tutupDaftarGuru() {
                document.getElementById('daftarGuru').classList.add('hidden');
            }

            function tutupDaftarKelas() {
                document.getElementById('daftarKelas').classList.add('hidden');
            }

            document.getElementById('santriCard').addEventListener('click', function(event) {
                event.stopPropagation();
                tutupDaftarGuru();
                tampilkanSebaranSantri();
            });

            document.getElementById('guruCard').addEventListener('click', function(event) {
                event.stopPropagation();
                tutupSebaranSantri();
                tampilkanDaftarGuru();
            });

            document.getElementById('kelasCard').addEventListener('click', function(event) {
                event.stopPropagation();
                tutupSebaranSantri();
                tutupDaftarGuru();
                tampilkanDaftarKelas();
            });

            document.addEventListener('click', function(event) {
                if (!event.target.closest('#sebaranSantri') && !event.target.closest('#santriCard') &&
                    !event.target.closest('#daftarGuru') && !event.target.closest('#guruCard') &&
                    !event.target.closest('#daftarKelas') && !event.target.closest('#kelasCard')) {
                    tutupSebaranSantri();
                    tutupDaftarGuru();
                    tutupDaftarKelas();
                }
            });

            // Fungsi untuk mengatur hamburger menu
            function setupHamburgerMenu() {
                const menuToggle = document.getElementById('menu-toggle');
                const mobileMenu = document.getElementById('mobile-menu');

                if (menuToggle && mobileMenu) {
                    menuToggle.addEventListener('click', function(event) {
                        event.stopPropagation();
                        mobileMenu.classList.toggle('hidden');
                    });

                    document.addEventListener('click', function(event) {
                        if (!mobileMenu.contains(event.target) && !menuToggle.contains(event.target)) {
                            mobileMenu.classList.add('hidden');
                        }
                    });
                } else {
                    console.error('Menu toggle or mobile menu elements not found');
                }
            }

            // Panggil fungsi setup hamburger menu
            setupHamburgerMenu();

            tampilkanStatistik();
        });
    </script>
</body>
</html>
